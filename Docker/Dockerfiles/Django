# Pull base image
FROM python:slim

# Install libmagic
RUN apt update && apt upgrade && apt install -y --no-install-recommends libmagic1 && rm -rf /var/lib/apt/lists/*

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

# Install dependencies
RUN pip install pipenv
RUN pip install uvicorn

RUN mkdir /api
WORKDIR /api
COPY ./backend/Pipfile* /api/

RUN pipenv install --system
COPY ./backend/ /api/